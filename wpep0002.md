| Key | Value |
| ---: | :--- |
| **Title** | Improve distributed capabilities |
| **Number** | 0002 |
| **Date** | 2019-10-21 |
| **Authors** | Frederic Lepied <flepied@wazo.io> |
| **Status** | proposed |

## Abstract

Redesign the way services find each other and their configurations.

## Motivation

To be able to cope with container deployements like kubernetes, swarm
or docker-compose as well as distributed deployments on vm or bare
metal, the startup sequences of the services need to be more dynamic
without anything being done at install time.

## Proposition

Use Consul to discover services and settings.

While the needed services are not started (nothing in Consul), the
service shound wait for them to start and publish their informations.

If a service needs a database, it should manage it at startup: create
it if it doesn't exist and do the modifications if a database schema
change is needed.

To summarize, nothing should be done by the packages or the ansible
installer like creating databases or certificates. Nothing should be
configured by the ansible installer or the packages scripts.

For non Consul aware services like Asterisk, Kamailio, RTPEngine,
PostgreSQL or RabbitMQ, how do we proceed?
